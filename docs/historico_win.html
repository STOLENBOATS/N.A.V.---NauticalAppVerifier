<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NAV • Histórico WIN</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header>
    <img src="assets/logo-pm.svg" alt="Polícia Marítima">
    <h1>Histórico • WIN</h1>
  </header>
  <main>
    <div class="row">
      <a class="tag" href="validador.html">◀ Voltar ao Validador</a>
      <button id="exportWinCsv" class="btn secondary">Exportar CSV</button>
    </div>
    <div class="card">
      <table id="winTable">
        <thead>
          <tr>
            <th>Data</th><th>WIN</th><th>Resultado</th><th>Justificação</th><th>Foto</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>
  <script src="js/utils.js"></script>
  <script>
    const tbody = document.querySelector('#winTable tbody');
    const rows = JSON.parse(localStorage.getItem('winHistory')||'[]');
    for(const r of rows){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${r.date}</td>
                      <td>${r.win}</td>
                      <td>${r.result}</td>
                      <td>${r.reason||''}</td>
                      <td>${r.photo?'<img class="preview" src="'+r.photo+'">':''}</td>`;
      tbody.appendChild(tr);
    }
    document.getElementById('exportWinCsv').addEventListener('click',()=>{
      const data = [['Data','WIN','Resultado','Justificação','Foto']].concat(
        rows.map(r=>[r.date,r.win,r.result,r.reason||'',r.photo||''])
      );
      downloadCSV('historico_win.csv', data);
    });
  </script>
</body>
</html>