(function(){const ms=document.getElementById('marca'),bf=document.getElementById('brandFields');const st=document.getElementById('motorStatus'),panel=document.getElementById('motorInterpretacao'),kv=document.getElementById('motorKV');const tpl={yamaha:`<div class="row"><div><label>Modelo (ex.: F350NSA)<br><small class="muted">EN: Model code</small></label><input id="y_modelo" type="text" placeholder="F350NSA"></div><div><label>Código (ex.: 6ML)<br><small class="muted">EN: Code</small></label><input id="y_codigo" type="text" placeholder="6ML"></div></div><div class="row"><div><label>Letra (ex.: N)<br><small class="muted">EN: Letter</small></label><input id="y_letra" type="text" placeholder="N"></div><div><label>Nº Série (ex.: 1005843)<br><small class="muted">EN: Serial number</small></label><input id="y_sn" type="text" placeholder="1005843"></div></div>`,honda:`<div class="row"><div><label>Modelo<br><small class="muted">EN: Model</small></label><input id="h_modelo" type="text" placeholder="BF150A"></div><div><label>Prefixo<br><small class="muted">EN: Prefix</small></label><input id="h_prefixo" type="text" placeholder="BBAY"></div></div><div class="row"><div><label>Nº Série<br><small class="muted">EN: Serial number</small></label><input id="h_sn" type="text" placeholder="1234567"></div></div>`};function onChange(){const v=ms.value;panel.classList.add('hidden');kv.innerHTML='';st.textContent='';bf.innerHTML='';if(!v)return;const w=document.createElement('div');w.className='card';w.innerHTML=tpl[v];bf.appendChild(w);}ms.addEventListener('change',onChange);function setS(ok,msg){st.className='helper status '+(ok?'ok':'bad');st.textContent=msg;}function ts(){const d=new Date();return `${d.getFullYear()}-${('0'+(d.getMonth()+1)).slice(-2)}-${('0'+d.getDate()).slice(-2)} ${('0'+d.getHours()).slice(-2)}:${('0'+d.getMinutes()).slice(-2)}`;}function vY(d){if(!d.modelo)return{ok:false,motivo:'Modelo em falta.'};if(!d.codigo)return{ok:false,motivo:'Código em falta.'};if(!d.letra||!/^[A-Z]$/i.test(d.letra))return{ok:false,motivo:'Letra inválida.'};if(!d.sn||!/^\d{5,8}$/.test(d.sn))return{ok:false,motivo:'Nº série inválido.'};return{ok:true,kv:[['Modelo','Model',d.modelo],['Código','Code',d.codigo],['Letra','Letter',d.letra.toUpperCase()],['Nº Série','Serial',d.sn]]};}function vH(d){if(!d.modelo)return{ok:false,motivo:'Modelo em falta.'};if(!d.prefixo)return{ok:false,motivo:'Prefixo em falta.'};if(!d.sn||!/^\d{5,8}$/.test(d.sn))return{ok:false,motivo:'Nº série inválido.'};return{ok:true,kv:[['Modelo','Model',d.modelo],['Prefixo','Prefix',d.prefixo],['Nº Série','Serial',d.sn]]};}function render(items){kv.innerHTML=items.map(([pt,en,val])=>`<dt>${pt} / ${en}</dt><dd>${val}</dd>`).join('');}document.getElementById('btnValidarMotor').addEventListener('click',()=>{const v=ms.value;if(!v){setS(false,'Selecione uma marca. EN: Select a brand.');panel.classList.add('hidden');kv.innerHTML='';return;}let res=null;if(v==='yamaha'){res=vY({modelo:(document.getElementById('y_modelo')||{}).value||'',codigo:(document.getElementById('y_codigo')||{}).value||'',letra:(document.getElementById('y_letra')||{}).value||'',sn:(document.getElementById('y_sn')||{}).value||''});}if(v==='honda'){res=vH({modelo:(document.getElementById('h_modelo')||{}).value||'',prefixo:(document.getElementById('h_prefixo')||{}).value||'',sn:(document.getElementById('h_sn')||{}).value||''});}if(!res.ok){setS(false,'Inválido: '+res.motivo+' EN: Invalid.');panel.classList.add('hidden');kv.innerHTML='';}else{setS(true,'Válido. EN: Valid.');render(res.kv);panel.classList.remove('hidden');}setTimeout(()=>{const ok=st.classList.contains('ok');const dts=ts();const brand=v;let model='',sn='';if(brand==='yamaha'){model=(document.getElementById('y_modelo')||{}).value||'';sn=(document.getElementById('y_sn')||{}).value||'';}if(brand==='honda'){model=(document.getElementById('h_modelo')||{}).value||'';sn=(document.getElementById('h_sn')||{}).value||'';}const photo=sessionStorage.getItem('motor_last_photo')||'';const arr=JSON.parse(localStorage.getItem('hist_motor')||'[]');arr.unshift({dt:dts,brand,model,sn,result:ok?'Válido':'Inválido',just:st.textContent||'',photo});localStorage.setItem('hist_motor',JSON.stringify(arr.slice(0,200)));},10);});})();