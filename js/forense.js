(function(){const rs=document.getElementById('refSelect'),ui=document.getElementById('userPhoto'),a=document.getElementById('alpha'),cv=document.getElementById('canvas'),ctx=cv.getContext('2d');let user=null,ref=new Image();function draw(){ctx.clearRect(0,0,cv.width,cv.height);if(user){const uw=user.width,uh=user.height;const s=Math.min(cv.width/uw,cv.height/uh);const w=Math.round(uw*s),h=Math.round(uh*s);const x=Math.round((cv.width-w)/2),y=Math.round((cv.height-h)/2);ctx.drawImage(user,x,y,w,h);if(ref&&ref.src){ctx.save();ctx.globalAlpha=parseFloat(a.value||'0.4');ctx.drawImage(ref,x,y,w,h);ctx.restore();}}else if(ref&&ref.src){ctx.save();ctx.globalAlpha=parseFloat(a.value||'0.4');const rw=ref.width,rh=ref.height;const s=Math.min(cv.width/rw,cv.height/rh);const w=Math.round(rw*s),h=Math.round(rh*s);const x=Math.round((cv.width-w)/2),y=Math.round((cv.height-h)/2);ctx.drawImage(ref,x,y,w,h);ctx.restore();}}rs.addEventListener('change',()=>{ref=new Image();ref.onload=draw;ref.src=rs.value;});a.addEventListener('input',draw);ui.addEventListener('change',()=>{const f=ui.files&&ui.files[0];if(!f)return;const fr=new FileReader();fr.onload=()=>{user=new Image();user.onload=draw;user.src=fr.result;};fr.readAsDataURL(f);});ref.onload=draw;ref.src=rs.value;draw();})();